<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeVoyage Simple Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .success { background: #2d5a2d; color: #90ee90; }
        .error { background: #5a2d2d; color: #ff6b6b; }
        .warning { background: #5a5a2d; color: #ffeb3b; }
        .info { background: #2d2d5a; color: #87ceeb; }
        #map { height: 300px; width: 100%; margin: 10px 0; border: 1px solid #333; }
        button {
            background: #00ff88;
            color: black;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #00cc6a; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ VibeVoyage Simple Test</h1>
        
        <div>
            <button onclick="testModuleLoading()">Test Module Loading</button>
            <button onclick="testAppInitialization()">Test App Initialization</button>
            <button onclick="testBasicFunctionality()">Test Basic Functions</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
        
        <div id="map"></div>
        
        <div id="results"></div>
    </div>

    <!-- Dependencies -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Core modules -->
    <script src="src/core/BaseModule.js"></script>
    <script src="src/core/ModuleLoader.js"></script>
    <script src="src/core/AppCore.js"></script>
    
    <!-- Application modules -->
    <script src="src/modules/SettingsManager.js"></script>
    <script src="src/modules/LanguageManager.js"></script>
    <script src="src/modules/MapManager.js"></script>
    <script src="src/modules/LocationManager.js"></script>
    <script src="src/modules/RouteManager.js"></script>
    <script src="src/modules/NavigationManager.js"></script>
    <script src="src/modules/UIManager.js"></script>
    <script src="src/modules/GamificationManager.js"></script>
    <script src="src/modules/HazardManager.js"></script>
    
    <!-- Main application -->
    <script src="VibeVoyageApp.js"></script>

    <script>
        let testResults = [];
        
        function logResult(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const result = {
                timestamp,
                message,
                type
            };
            
            testResults.push(result);
            displayResults();
            console.log(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
        }
        
        function displayResults() {
            const container = document.getElementById('results');
            container.innerHTML = testResults.map(result => 
                `<div class="test-result ${result.type}">
                    [${result.timestamp}] ${result.message}
                </div>`
            ).join('');
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }
        
        function clearResults() {
            testResults = [];
            displayResults();
        }
        
        function testModuleLoading() {
            logResult('Testing module loading...', 'info');
            
            const requiredModules = [
                'BaseModule', 'ModuleLoader', 'AppCore',
                'SettingsManager', 'LanguageManager', 'MapManager', 'LocationManager',
                'RouteManager', 'NavigationManager', 'UIManager', 'GamificationManager', 'HazardManager',
                'VibeVoyageApp'
            ];
            
            let loadedCount = 0;
            let missingModules = [];
            
            requiredModules.forEach(moduleName => {
                if (typeof window[moduleName] !== 'undefined') {
                    loadedCount++;
                    logResult(`‚úÖ ${moduleName} loaded`, 'success');
                } else {
                    missingModules.push(moduleName);
                    logResult(`‚ùå ${moduleName} missing`, 'error');
                }
            });
            
            if (missingModules.length === 0) {
                logResult(`All ${loadedCount} modules loaded successfully!`, 'success');
            } else {
                logResult(`${missingModules.length} modules missing: ${missingModules.join(', ')}`, 'error');
            }
            
            // Test Leaflet
            if (typeof L !== 'undefined') {
                logResult('‚úÖ Leaflet library loaded', 'success');
            } else {
                logResult('‚ùå Leaflet library missing', 'error');
            }
        }
        
        async function testAppInitialization() {
            logResult('Testing app initialization...', 'info');
            
            try {
                // Create app instance
                const app = new VibeVoyageApp();
                logResult('‚úÖ VibeVoyageApp instance created', 'success');
                
                // Initialize app
                logResult('Initializing application...', 'info');
                await app.initialize();
                logResult('‚úÖ Application initialized successfully', 'success');
                
                // Test app state
                const state = app.getState();
                logResult(`App state: initialized=${state.initialized}`, state.initialized ? 'success' : 'error');
                
                // Test module access
                const modules = ['SettingsManager', 'LanguageManager', 'MapManager', 'LocationManager'];
                modules.forEach(moduleName => {
                    const module = app.getModule(moduleName);
                    if (module) {
                        logResult(`‚úÖ ${moduleName} accessible`, 'success');
                    } else {
                        logResult(`‚ùå ${moduleName} not accessible`, 'error');
                    }
                });
                
                // Store app globally for other tests
                window.testApp = app;
                
            } catch (error) {
                logResult(`‚ùå App initialization failed: ${error.message}`, 'error');
                console.error('Initialization error:', error);
            }
        }
        
        async function testBasicFunctionality() {
            logResult('Testing basic functionality...', 'info');
            
            if (!window.testApp) {
                logResult('‚ùå No app instance available. Run initialization test first.', 'error');
                return;
            }
            
            const app = window.testApp;
            
            try {
                // Test settings
                const settingsManager = app.getModule('SettingsManager');
                if (settingsManager) {
                    const settings = settingsManager.getAllSettings();
                    logResult(`‚úÖ Settings loaded: ${Object.keys(settings).length} categories`, 'success');
                } else {
                    logResult('‚ùå SettingsManager not available', 'error');
                }
                
                // Test language
                const languageManager = app.getModule('LanguageManager');
                if (languageManager) {
                    const currentLang = languageManager.getCurrentLanguage();
                    const translation = languageManager.translate('startNavigation');
                    logResult(`‚úÖ Language: ${currentLang}, Translation: "${translation}"`, 'success');
                } else {
                    logResult('‚ùå LanguageManager not available', 'error');
                }
                
                // Test map
                const mapManager = app.getModule('MapManager');
                if (mapManager) {
                    const isReady = mapManager.isReady();
                    logResult(`Map ready: ${isReady}`, isReady ? 'success' : 'warning');
                } else {
                    logResult('‚ùå MapManager not available', 'error');
                }
                
                // Test gamification
                const gamificationManager = app.getModule('GamificationManager');
                if (gamificationManager) {
                    const stats = gamificationManager.getUserStats();
                    logResult(`‚úÖ User stats: Level ${stats.level}, ${stats.points} points`, 'success');
                } else {
                    logResult('‚ùå GamificationManager not available', 'error');
                }
                
                // Test hazards
                const hazardManager = app.getModule('HazardManager');
                if (hazardManager) {
                    const hazardTypes = hazardManager.getHazardTypes();
                    logResult(`‚úÖ Hazard types: ${Object.keys(hazardTypes).length} available`, 'success');
                } else {
                    logResult('‚ùå HazardManager not available', 'error');
                }
                
                logResult('‚úÖ Basic functionality test completed', 'success');
                
            } catch (error) {
                logResult(`‚ùå Basic functionality test failed: ${error.message}`, 'error');
                console.error('Functionality test error:', error);
            }
        }
        
        // Auto-run module loading test on page load
        document.addEventListener('DOMContentLoaded', () => {
            logResult('Page loaded, starting tests...', 'info');
            testModuleLoading();
        });
    </script>
</body>
</html>
